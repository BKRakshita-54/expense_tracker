<!DOCTYPE html>
<html>
<head>
    <title>Home - Expense Tracker</title>
    <link rel="stylesheet" href="/static/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<!-- NAVBAR -->
<div class="navbar">
    <div class="nav-left">Expense Tracker</div>
    <div class="nav-right">
        <a href="/home">Home</a>
        <a href="/add_budget">Add Budget</a>
        <a href="/manage_expenses">Add / Edit Expenses</a>
        <a href="/logout" class="logout">Logout</a>
    </div>
</div>

<div class="page-container">
    <div class="card">
        <h2>Welcome, {{ username }}</h2>
        <div class="two-col">
            <div class="stat-card">
                <h4>Total Income</h4>
                <div class="stat-value">₹{{ total_income }}</div>
                <form action="/update_income" method="POST" class="inline-form">
                    <input type="number" step="0.01" name="new_income" placeholder="Update income">
                    <button type="submit">Save</button>
                </form>
            </div>
            <div class="stat-card">
                <h4>Total Expense</h4>
                <div class="stat-value" style="color:#ff6464">₹{{ total_expense }}</div>
            </div>
        </div>
    </div>
    <div class="chart-row">

    <div class="chart-card">
        <h3>Category-wise Expense (All Time)</h3>
        <canvas id="pieChart"></canvas>
    </div>

    <div class="chart-card">
        <h3>Category-wise Expense ({{ selected_month }})</h3>
        <canvas id="barChart"></canvas>
    </div>

</div>
</div>

<!-- JSON -->
<script id="pie-labels" type="application/json">{{ category_labels|tojson }}</script>
<script id="pie-values" type="application/json">{{ category_totals|tojson }}</script>
<script id="bar-labels" type="application/json">{{ bar_labels|tojson }}</script>
<script id="bar-values" type="application/json">{{ bar_values|tojson }}</script>

<script>
const pieLabels = JSON.parse(document.getElementById('pie-labels').textContent || '[]');
const pieValues = JSON.parse(document.getElementById('pie-values').textContent || '[]');
const barLabels = JSON.parse(document.getElementById('bar-labels').textContent || '[]');
const barValues = JSON.parse(document.getElementById('bar-values').textContent || '[]');

new Chart(document.getElementById('pieChart'), {
    type: 'pie',
    data: { labels: pieLabels, datasets: [{ data: pieValues, backgroundColor: ['#7bd389','#7fb3ff','#ffb86b','#ff8a8a','#8fa3e6','#ffd1dc'] }] }
});

new Chart(document.getElementById('barChart'), {
    type: 'bar',
    data: { labels: barLabels, datasets: [{ label: '₹ Spent', data: barValues, backgroundColor: '#66a3ff' }] },
    options: { scales: { y: { beginAtZero: true } } }
});
</script>
</body>
</html>
